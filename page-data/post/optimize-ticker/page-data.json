{"componentChunkName":"component---src-templates-post-tsx","path":"/post/optimize-ticker/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"잦은 렌더링이 불가피할 때 최적화하기 (실시간 시세)","slug":"optimize-ticker","tags":["React"],"date":"2025-01-28 02:14:00"},"html":"<p><a href=\"1.webm\">1.webm</a></p>\n<p>최근에 암호화폐 실시간 시세를 보여주는 사이트를 만들고 있는데, TPS가 500 이상 치솟는 경우가 많다.</p>\n<p>당연히, 최적화를 하지 않으면 성능적으로 문제가 발생할 거라 생각했고 실제로 어느정도 차이가 나는지 궁금하여 이를 확인하기 위해 간단한 실험을 하였다.</p>\n<blockquote>\n<p><strong>6.5초 동안 3000번의 업데이트</strong>가 발생할 때, 어느 정도 시간이 소요되는지 로직을 차례대로 개선하면서 확인한다.</p>\n<p><em>(Chrome DevTools Performance 패널을 통해 런타임 성능을 분석하였으며, Production mode에서 확인하였다.)</em></p>\n</blockquote>\n<hr>\n<h2 id=\"개선-전-로직\" style=\"position:relative;\">개선 전 로직<a href=\"#%EA%B0%9C%EC%84%A0-%EC%A0%84-%EB%A1%9C%EC%A7%81\" aria-label=\"개선 전 로직 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<ol>\n<li><strong>모든 종목의 시세를 하나의 상태</strong>에서 관리한다.</li>\n<li>개별 종목의 시세 업데이트 정보를 받으면, 상태를 업데이트 한다.</li>\n<li>해당 상태를 바탕으로 각 컴포넌트(시세를 보여주는 컴포넌트)마다 props로 전달해준다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ba93bffa66c8a66fce27e2bea2ddc1e3/71ce0/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.177914110429448%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlklEQVR42h2NyRKCMBAF+f+f86LlQYUi22Qmy4SUEA2hMOU79+se8rKQ45Ie3+WhwRFh23fvAzPvfEmRZiG3bStls+jXJGq6IUWt1XEcQ87Zog2YnIlCzlLKWisAEJFTjBbHceyiUopUMhI71THRsW4c3usayE+sn0FYBeTceZ797L2/xpdB0Ep9/gNtNOM9TNZA77XWfmAmpcQFvgb/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/ba93bffa66c8a66fce27e2bea2ddc1e3/71ce0/image.png\"\n        srcset=\"/static/ba93bffa66c8a66fce27e2bea2ddc1e3/222b7/image.png 163w,\n/static/ba93bffa66c8a66fce27e2bea2ddc1e3/ff46a/image.png 325w,\n/static/ba93bffa66c8a66fce27e2bea2ddc1e3/71ce0/image.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>총 3번 테스트했으며, <code class=\"language-text\">Scripting</code> + <code class=\"language-text\">Rendering</code> + <code class=\"language-text\">Painting</code> 시간의 평균값은 2526ms이다.</p>\n<hr>\n<h2 id=\"1차-개선---상태-업데이트-개선하기\" style=\"position:relative;\">1차 개선 - 상태 업데이트 개선하기<a href=\"#1%EC%B0%A8-%EA%B0%9C%EC%84%A0---%EC%83%81%ED%83%9C-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EA%B0%9C%EC%84%A0%ED%95%98%EA%B8%B0\" aria-label=\"1차 개선   상태 업데이트 개선하기 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<ol>\n<li>모든 종목의 시세를 하나의 상태에서 관리하지 않고, <strong>개별 종목마다 별도의 상태</strong>(전역)를 갖는다.</li>\n<li>각 컴포넌트는 시세를 props 대신 전역 상태로부터 전달받는다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 464px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef09e29d2dcd9c6a7bde2905003f2e6a/69096/image1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.56441717791411%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmElEQVR42g3MQQ6DIBBAUe9/ui66aKxBUQRmhgFEYwNErPv/frfvSVv6RZFjrzQB2Naac47ZV//aAo2TPM+zlmIs7mGt4Q3IyzJf19WllKzVYIJRfpyEnGQplYgQUUuvVzMMX2bOOatVIbCe/bzMQojn2B3H4YlVsiIqsvh0932HEGKMnziSd0brR5ZSvGPYXB8lowOE1tofUwWmHTGdIlMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/ef09e29d2dcd9c6a7bde2905003f2e6a/69096/image1.png\"\n        srcset=\"/static/ef09e29d2dcd9c6a7bde2905003f2e6a/222b7/image1.png 163w,\n/static/ef09e29d2dcd9c6a7bde2905003f2e6a/ff46a/image1.png 325w,\n/static/ef09e29d2dcd9c6a7bde2905003f2e6a/69096/image1.png 464w\"\n        sizes=\"(max-width: 464px) 100vw, 464px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">Scripting</code> 시간이 기존 로직 대비 35% 수준으로 단축됐다.</p>\n<p>시세 정보는 단순히 ticker나 가격만 포함하는 게 아니라 거래량, 52주 신고가 등 다양한 정보를 포함하고 있기에 생각보다 용량이 크다. 종목 수가 153개인데 모든 종목의 데이터가 130KB 가량된다. 그래서 개선 전 로직에서 상태를 업데이트하는 과정에서 많은 <code class=\"language-text\">Scripting</code> 시간이 소요됐을 것이다.</p>\n<hr>\n<h2 id=\"2차-개선---화면에-보이는-부분만-업데이트-하기\" style=\"position:relative;\">2차 개선 - 화면에 보이는 부분만 업데이트 하기<a href=\"#2%EC%B0%A8-%EA%B0%9C%EC%84%A0---%ED%99%94%EB%A9%B4%EC%97%90-%EB%B3%B4%EC%9D%B4%EB%8A%94-%EB%B6%80%EB%B6%84%EB%A7%8C-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%ED%95%98%EA%B8%B0\" aria-label=\"2차 개선   화면에 보이는 부분만 업데이트 하기 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<ol>\n<li>\n<p>Viewport 내에 존재하는 컴포넌트만 업데이트를 하도록 변경하였다.</p>\n<p>정확하게 말하자면, 상태 자체는 업데이트하지만, dom에 반영하는 과정을 생략하였다.</p>\n<p>(Viewport 내에 존재하는 컴포넌트는 총 153개 중 42개로, 전체의 27.45%이다.)</p>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 464px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f489e0cdbea68e70e587c5486e7ef75/69096/image2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.56441717791411%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlklEQVR42h3B2xKCIBAAUP//86rpoSYFcYHltpqBCoHNdE4XP6vSLs3DPj8mMIjYWkPUzvtMl4WQMZ5SKqUohSvJTDeNbhKi1tat70Uq8Dg7Gbjg4yhK+Zo/Kwi1GYbeBzqOAyR4Q3YKUgJjLKati/FDLjCCZ+AI2lp7nqe1Jnh/DS90OAnY9j3n7I1ThPfQO41K61rrD1+ipf6vxBngAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/4f489e0cdbea68e70e587c5486e7ef75/69096/image2.png\"\n        srcset=\"/static/4f489e0cdbea68e70e587c5486e7ef75/222b7/image2.png 163w,\n/static/4f489e0cdbea68e70e587c5486e7ef75/ff46a/image2.png 325w,\n/static/4f489e0cdbea68e70e587c5486e7ef75/69096/image2.png 464w\"\n        sizes=\"(max-width: 464px) 100vw, 464px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>기존 로직 대비 <code class=\"language-text\">Rendering</code> + <code class=\"language-text\">Painting</code> 시간이 거의 1/3 수준으로 감소했다.</p>\n<p>두 차례의 개선을 거친 결과, <code class=\"language-text\">Scripting</code> + <code class=\"language-text\">Rendering</code> + <code class=\"language-text\">Painting</code> 시간이 2526ms → 917ms로 단축되어, 총 6500ms의 측정 시간 중 1609ms의 idle time을 확보할 수 있었다.</p>"},"prev":{"frontmatter":{"slug":"stacking-context","title":"쌓임 맥락 (stacking context)"}},"next":{"frontmatter":{"slug":"npm-publish","title":"npm 라이브러리 개발부터 배포까지"}}},"pageContext":{"id":"c4fb50e2-c67d-571e-9faa-09e0629d8d57","prev":"952dcaa3-5cd4-53b4-a831-2ec87f9fa3f8","next":"9d6cadcd-fa33-5892-9109-deeb1114c99f"}},"staticQueryHashes":["1218423607"],"slicesMap":{}}
{"componentChunkName":"component---src-templates-post-tsx","path":"/post/trigger-transition/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"transition이 발생하지 않는 이유","slug":"trigger-transition","tags":["JavaScript","CSS","Browser"],"date":"2025-02-23 23:50:00"},"html":"<h2 id=\"문제-상황\" style=\"position:relative;\">문제 상황<a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"문제 상황 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      .box {\n        width: 100px;\n        height: 100px;\n\n        background-color: green;\n      }\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      function test() {\n        const $box = document.querySelector(\".box\");\n\n        $box.style.backgroundColor = \"red\";\n        $box.style.transition = \"all 1s\";\n        $box.style.backgroundColor = \"blue\";\n      }\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">box</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token special-attr\"><span class=\"token attr-name\">onClick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Button</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위와 같은 코드에서 <code class=\"language-text\">test()</code> 를 호출했을 때 box의 background-color가 어떻게 변화될까요?</p>\n<p>개발자는 red → blue로 transition이 일어나는 걸 의도했겠지만 결과는 아래와 같이 green → blue로 transition이 됩니다.</p>\n<p><img src=\"/d0f2bf91cc9ab0b0f2d676ddcc6aee11/1.gif\" alt=\"1.gif\"></p>\n<h2 id=\"의도한-것과-결과가-다른-이유\" style=\"position:relative;\">의도한 것과 결과가 다른 이유<a href=\"#%EC%9D%98%EB%8F%84%ED%95%9C-%EA%B2%83%EA%B3%BC-%EA%B2%B0%EA%B3%BC%EA%B0%80-%EB%8B%A4%EB%A5%B8-%EC%9D%B4%EC%9C%A0\" aria-label=\"의도한 것과 결과가 다른 이유 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<p>JavaScript로 element의 style을 변경해도 즉시 적용되지 않습니다.</p>\n<p>브라우저는 JavaScript의 동기적인 코드가 끝난 뒤 렌더링 과정을 일괄적으로 처리합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c9fc4c17703e7787368846b865ff9a3f/d3f96/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.337423312883436%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwklEQVR42gG3AEj/APvx1vbgqPfksvfjsPjksdzP5s7B89HF8dTI8s/B8NDB89HN6L/ct73atsLcu8Lcu73Ztr7bt7rYst7s2gD23JztvEDux2Htw1v0xEC2k66Ve+yWeeCXeuOXfOKafeSSftVyrmdxsGJurl9wr2FzsWR6tG1oqlmv0qYA+vDX9eCp9uKx9uKv9+Ox287mzb/00sXy1Mjyz8Lx0MH00c3pvtu2u9i0wty7wdy7vNm1v9u4uNex3eza+66Hle/aGMgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/c9fc4c17703e7787368846b865ff9a3f/a6d36/0.png\"\n        srcset=\"/static/c9fc4c17703e7787368846b865ff9a3f/222b7/0.png 163w,\n/static/c9fc4c17703e7787368846b865ff9a3f/ff46a/0.png 325w,\n/static/c9fc4c17703e7787368846b865ff9a3f/a6d36/0.png 650w,\n/static/c9fc4c17703e7787368846b865ff9a3f/e548f/0.png 975w,\n/static/c9fc4c17703e7787368846b865ff9a3f/d3f96/0.png 1093w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"알려진-해결-방법들\" style=\"position:relative;\">알려진 해결 방법들<a href=\"#%EC%95%8C%EB%A0%A4%EC%A7%84-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95%EB%93%A4\" aria-label=\"알려진 해결 방법들 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<p>이 문제에 대해 검색을 해보면 몇 가지 해결책을 찾아볼 수 있습니다.</p>\n<p>흔히 찾아볼 수 있는 4가지 방법을 정리했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 1</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 2</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 3</span>\n<span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 4</span>\n$box<span class=\"token punctuation\">.</span>offsetTop<span class=\"token punctuation\">;</span>\n$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>solution 1~4 모두 red → blue로 transition이 발생하여 처음 의도한대로 작동합니다.</p>\n<p>하지만 solution 1~3은 항상 작동을 보장하지 않는 잘못된 방법입니다.</p>\n<h2 id=\"잘못된-방법인-이유\" style=\"position:relative;\">잘못된 방법인 이유<a href=\"#%EC%9E%98%EB%AA%BB%EB%90%9C-%EB%B0%A9%EB%B2%95%EC%9D%B8-%EC%9D%B4%EC%9C%A0\" aria-label=\"잘못된 방법인 이유 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<p>이유를 알기 위해서는 브라우저의 렌더링이 언제 실행되는지 알아야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9265efbbe050824a2513fa8dade8c1c4/2cefc/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.00613496932516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVR42pWS2ZKbMBBF/f8/lAc/ZiZ24pqMVwzeMAbEKhYD2iXSxPZ4qlJ5mK5SIVS63a17etT3vTGGMaa1/thLKft/gnN+u/MRI1iM8yBETUeUMYTxMIrKqlJaQQoBS2shFZcqTtKOUKmNlHDxIVaPfNqYjnH/iuaX9SrcXurgXJw3/uaYH3FbFV1/iK7HuMWN7P+qBzGXOsTshK6o5EzwOFi6u1f/OE1S20nt99ObFa3LrvbTZr6Pl4cE4fbZNhfC9/3t1gpQCOI2eM+c79X+tU6tbWK/7WcbtC5JHWTtfBf9dhDKm6dYCkrTdXGesdSinKnKK/1lhyxSX9zCs7yNi12onDdqH9aHsMbtp7apYKtwNXF+WPFWKCUVmKDh/YRSMAz8B8/AJD+nixNeuiUqKGC5i+EeVzLLcyhrzBMGMFNK3faQQigNRAiFQ9Pf3IYaDP6lgqvmRuARgIkQ8vkQUFNKn5wh9xEdvczDuGDlpSfxPe1/BgPkgP8uFprPvF9T92dZhdniW74ZS1YLCE605E1Tt5QwyakAioILXTek6ZiAWTEG2lb7eHfITg1lXWQV53cQZKfpZTlGq3GTOFZiv2xepvuJX4aOf52svJkdhZg8OFPixu3Exjsfl1Up1eCtFAr4g/NSq6GPYU7BmWFUh9OhcD+6vS+p+MKtcSP6r8ToTmIAdvt+QfwHmnFZP3wK0d8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/9265efbbe050824a2513fa8dade8c1c4/a6d36/1.png\"\n        srcset=\"/static/9265efbbe050824a2513fa8dade8c1c4/222b7/1.png 163w,\n/static/9265efbbe050824a2513fa8dade8c1c4/ff46a/1.png 325w,\n/static/9265efbbe050824a2513fa8dade8c1c4/a6d36/1.png 650w,\n/static/9265efbbe050824a2513fa8dade8c1c4/e548f/1.png 975w,\n/static/9265efbbe050824a2513fa8dade8c1c4/3c492/1.png 1300w,\n/static/9265efbbe050824a2513fa8dade8c1c4/2cefc/1.png 1400w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>위 그림처럼 브라우저의 렌더링을 실행하는 Render Queue가 존재합니다.</p>\n<p>그림에는 나타나 있지 않아 추가적으로 설명할 내용이 있는데,</p>\n<ol>\n<li>\n<p>Microtask Queue > Render Queue > (Macro)Task Queue 순으로 우선 순위를 가집니다.</p>\n</li>\n<li>\n<p>Render Queue의 작업은 매번 Call Stack에 추가되는 것이 아니라 브라우저가 업데이트가 필요하다고 판단하는 순간에만 추가됩니다.</p>\n<p>(일반적으로 주사율에 맞추어 60FPS 기준 16.6ms마다 Render Queue가 비워집니다.)</p>\n</li>\n</ol>\n<p>그리고 한 가지 더 주목할 점은 Style 과정 이전에 RAF (requestAnmationFrame)이 실행되는 것입니다.</p>\n<p>저희가 처음 의도한대로 transition이 발생하려면 첫 번째 style 변경과 두 번째 style 변경 사이에 렌더링이 실행되어야 합니다.</p>\n<p>이 내용을 바탕으로 solution 1~3이 왜 잘못된 방법인지 확인해 봅시다.</p>\n<h3 id=\"Solution-1\" style=\"position:relative;\">Solution 1<a href=\"#Solution-1\" aria-label=\"Solution 1 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 1</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>setTimeout의 콜백 함수(두 번째 style 변경)가 Task Queue에 추가되고,</p>\n<p>Render Queue는 Task Queue보다 우선 순위가 낮기 때문에 옳은 방법처럼 보이지만</p>\n<p>Render Queue의 작업은 항상 실행되는 것이 아니라 주사율에 맞추어 실행되기에 현재 setTimeout의 콜백 함수가 다음 렌더링 이후에 실행된다는 보장이 없습니다.</p>\n<h3 id=\"Solution-2\" style=\"position:relative;\">Solution 2<a href=\"#Solution-2\" aria-label=\"Solution 2 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 2</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Render Queue의 작업이 50ms 동안 실행되지 않는 상황이 드물기 때문에 정상 작동하는 것처럼 보이지만 이것 또한 작동을 보장한다고 보기 어렵고 transition이 지연되어 실행된다는 문제점이 있습니다.</p>\n<h3 id=\"Solution-3\" style=\"position:relative;\">Solution 3<a href=\"#Solution-3\" aria-label=\"Solution 3 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 3</span>\n<span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n  $box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>requestAnimationFrame은 브라우저 렌더링보다 먼저 실행됩니다. (Style 과정보다 먼저 실행됩니다.)</p>\n<h3 id=\"Solution-4\" style=\"position:relative;\">Solution 4<a href=\"#Solution-4\" aria-label=\"Solution 4 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// solution 4</span>\n$box<span class=\"token punctuation\">.</span>offsetTop<span class=\"token punctuation\">;</span>\n$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'all 1s'</span><span class=\"token punctuation\">;</span>\n$box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>offsetTop과 같이 레이아웃 연산이 필요한 일부 속성의 값을 가져오면 동기적인 Javascript 코드가 작동 중일 때도 reflow를 발생시킬 수 있고, 이를 통해 브라우저 렌더링을 실행할 수 있습니다.</p>\n<h2 id=\"reflow-성능-문제\" style=\"position:relative;\">reflow 성능 문제<a href=\"#reflow-%EC%84%B1%EB%8A%A5-%EB%AC%B8%EC%A0%9C\" aria-label=\"reflow 성능 문제 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<p>reflow를 사용하는 방법은 괜히 불필요한 연산을 발생시키는, 좋지 않는 방법일 것 같다는 생각이 듭니다.</p>\n<p>하지만, 일반적인 생각과 다르게 단순히 offsetTop과 같은 속성을 읽는 것만으로는 reflow(layout) 연산이 발생하지 않습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 210px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66325e2cfab2ac561fe1bf54a623830b/65ed1/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.96932515337423%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVR42o1RTUsCURR11a5dQv+j/9IvaRUhraJFf6E2giNqqWRoJSQRZonOjKZWjo4fY+ZM+Y0RvXmn64xGLiIPnHe479573r08BwjchAVdZghvKYjsKIi5mrjcbSO0/Yw4aczVsO7EA47MPlA8Aswvu4+ZHHM4rHMWTzoclashnhJveDirIO0TcecXIYeKSJNKwQLK0SbU2AtaNwY4438Y/ga3k922DOnWh9x9mHhCDEJKBUiP0dWuMehkqNT839CcJfVaCbnkOdRCCkY1SxRhqCL0qVLc00rLGfL5hLULZON7aMiH6Fe8RA8GVQ9GqoB+2Y1h/ZRq2TIr26+O8pvI+1dRja5D8q8hF3CSOvEYduIjuQKW36B1JgtbWYbTiRZpG471BAzFjZHmxVgTSAWMWwJ6dS8+X91g7zQhffN0IcbMn/5vlcL/URA50acAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/66325e2cfab2ac561fe1bf54a623830b/65ed1/2.png\"\n        srcset=\"/static/66325e2cfab2ac561fe1bf54a623830b/222b7/2.png 163w,\n/static/66325e2cfab2ac561fe1bf54a623830b/65ed1/2.png 210w\"\n        sizes=\"(max-width: 210px) 100vw, 210px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>위 스크린샷처럼 실제로 레이아웃의 변동이 없을 때는 get offsetTop이 발생해도 layout은 발생하지 않습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 199px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36fbdb5cf26ebf6768717865d956b976/3d64b/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.49079754601227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB2klEQVR42nWRy28SYRTFSZfGaExcmPgf+XcYN67aRBO7ML42JrowMelKY7SS1lRkkAotRVsFLQyUqTwGGOggtjxKHUJhkPKYnx9DMW48yfkW59x7cu/9HJgbGHE/u8+X0Za8pBZdFJd8lN4EyDk9pF+6+OldoxFaI/fqvV2jvvZQXPZRXgmiO0W/HAAzwOAwgAOBasTCfauM524J6c4PNh822XkyZPWe0G6XSDzrUhY90nwZ7/0SvgdVvj0yySyA8hgqX7AxMBkHjrBGgkNLEBp6isSWRFZep5r9ihpZp6ZFRJlFr3VEZvsDu2E/FTVMIfERLRag3/llB1oiwMFfWPZbK8VJR93kFbGSGiQVlajvhWzvxDwiG5OE5rU9TfFTUFbpd6eB1r+BE1T0PJs+iUIySquq0arkMPbztve70yIe2kAOBanradq1PEY5Q0/o/w3s6E/Z375GMzmHkbzBoTJLJzdve8P2d+qxqxzIs7TVOWo7N2klrzM4Vk6XHE0Dxf0mG9OQrxB+cYbGpws0P59Ddp6nsXV5UmO4iS3OkHRdoh89S/rdRdSVGTDensaIG47HnHIkeGIeiCMXGHaL4tcmHHb1iT9o0zvW6I81W9+zay2hjweyrBF/AP+RNjytEbhhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/36fbdb5cf26ebf6768717865d956b976/3d64b/3.png\"\n        srcset=\"/static/36fbdb5cf26ebf6768717865d956b976/222b7/3.png 163w,\n/static/36fbdb5cf26ebf6768717865d956b976/3d64b/3.png 199w\"\n        sizes=\"(max-width: 199px) 100vw, 199px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>실제로 레이아웃의 변동이 생겼을 때만 layout이 발생합니다.</p>\n<h2 id=\"잘못된-방법이-작동하는-이유\" style=\"position:relative;\">잘못된 방법이 작동하는 이유<a href=\"#%EC%9E%98%EB%AA%BB%EB%90%9C-%EB%B0%A9%EB%B2%95%EC%9D%B4-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"잘못된 방법이 작동하는 이유 permalink\" class=\"anchor after\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" width=\"1rem\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244\" /></svg></a></h2>\n<p>Solution 4가 작동을 항상 보장하는 제대로 된 방법이라는 걸 알았습니다.</p>\n<p>하지만 Solution 1~3은 이론적으로 작동하지 않아야 하는 방법인데도 왜 실제로 테스트해보면 red → blue로 transition이 발생하는 걸까요?</p>\n<p><img src=\"/103ff5a31f124965622ac498e98b6151/2.gif\" alt=\"2.gif\"></p>\n<p>이유는 버튼을 클릭하면 Recalculate style이 발생하기 때문입니다.</p>\n<p>(<a href=\"https://kimdw524.github.io/post/click-recalculate-style/\">https://kimdw524.github.io/post/click-recalculate-style/</a>)</p>\n<p><img src=\"/ea40d4d9a7d1c052f0695c391affd472/3.gif\" alt=\"3.gif\"></p>\n<p><code class=\"language-text\">test()</code> 함수를 버튼 클릭 핸들러가 아닌, 타이머를 통해 실행하면 Solution 1~3 방법은 green → blue로 transition이 발생하는 걸 확인할 수 있습니다.</p>"},"prev":{"frontmatter":{"slug":"jsdom-window","title":"jest + jsdom 환경에서 window instanceof Window"}},"next":{"frontmatter":{"slug":"stacking-context","title":"쌓임 맥락 (stacking context)"}}},"pageContext":{"id":"1f8f61a7-0efd-52d2-b596-e57e3e081ac1","prev":"750e6519-1c88-5346-9b6b-f79e4147f45c","next":"952dcaa3-5cd4-53b4-a831-2ec87f9fa3f8"}},"staticQueryHashes":["1218423607"],"slicesMap":{}}